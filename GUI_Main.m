clear;
close all;

% addpath('E:\MATLAB\TMS_IHI\exp_program2\Data',...
%     'E:\MATLAB\TMS_IHI\exp_program2\Functions');   % @USB at 9s3

scrsz   = get(0,'MonitorPosition');
set(gcf,'Units','Pixels','position',[200,200,940,460],...
    'Numbertitle','Off','Menu','None','Color',[0.8 0.8 0.8]);


%% Top panel

load_time = 1000;
trial_max = 40;

uicontrol(gcf,'Style','Text','Position',[10 415 300 35],...
    'string','HAYASHI  Exp_IHI','FontSize',30,'BackGroundColor',[0.8 0.8 0.8]);

UISession  = uicontrol(gcf,'Style','Text','Position',[300 415 200 35],...
    'string','Session1','FontSize',30,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[500 415 100 25],...
    'string','Time [ms]:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEdittime  = uicontrol(gcf,'Style','Edit','Position',[600 415 50 25],...
    'String','1000','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack','load_time = str2double(get(gcbo,''string''));');

uicontrol(gcf,'Style','Text','Position',[670 415 100 25],...
    'string','Max Trial:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEdittrial  = uicontrol(gcf,'Style','Edit','Position',[770 415 50 25],...
    'String','40','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack','trial_max = str2double(get(gcbo,''string''));');


%% Upper Left panel (ID, load data)
       
uicontrol(gcf,'Style','Text','Position',[20,382 125 25],...
    'String','Sub ID:','FontSize',18,'BackGroundColor',[0.8 0.8 0.8]);
UIEditsub  = uicontrol(gcf,'Style','Edit','Position',[20,360 125 25],...
    'String','','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack','Subjectname = get(gcbo,''string'');');
       
uicontrol(gcf,'Style','Text','Position',[145,382 125 25],...
    'String','Number:','FontSize',18,'BackGroundColor',[0.8 0.8 0.8]);
UIEditnum  = uicontrol(gcf,'Style','Edit','Position',[145,360 125 25],...
    'String','','FontSize',18,'BackGroundColor',[1 1 1],...
    'CallBack','Number = get(gcbo,''string'');');
       
uicontrol(gcf,'Style','Text','Position',[20,322 250 25],...
    'String','Select a calib. file:','FontSize',18,'BackGroundColor',[0.8 0.8 0.8]);
UIEditcalib = uicontrol(gcf,'Style','Push','Position',[20,297 70 28],...
    'String','Select','FontSize',16,'CallBack','SelectCalibFile');
UIDispCalib = uicontrol(gcf,'Style','Edit','Position',[90,300 180 25],...
    'String','Not selected','FontSize',10,'BackGroundColor',[1 1 1]);


%% Upper Left panel (TMS parameters)

perRMT = 120;
CSIntens_tmp = 48;
TSIntens_tmp = 48;
CSIntens     = 48;
TSIntens     = 48;
sense = 1;

uicontrol(gcf,'Style','Text','Position',[20,262 250 25],...
    'String','Intensity:','FontSize',18,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[70,240 50 25],...
    'String','rMT','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEditRMT   = uicontrol(gcf,'Style','Edit','Position',[140,240 50 25],...
    'String','120','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack',['perRMT = str2double(get(gcbo,''string''));'...
    'CSRMT = str2double(get(UIEditCS,''string''));'...
    'TSRMT = str2double(get(UIEditTS,''string''));'...
    'CSIntens_tmp=round(CSRMT*perRMT/100); set(UICSper,''string'',num2str(CSIntens_tmp));'...
    'TSIntens_tmp=round(TSRMT*perRMT/100); set(UITSper,''string'',num2str(TSIntens_tmp))']);
uicontrol(gcf,'Style','Text','Position',[185,240 15 25],...
    'String','%','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[210,240 50 25],...
    'String','Act.','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

%%% CS %%%
uicontrol(gcf,'Style','Text','Position',[20,218 30 25],...
    'String','CS:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEditCS = uicontrol(gcf,'Style','Edit','Position',[70,218 50 25],...
    'String','40','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack',['CSRMT = str2double(get(gcbo,''string''));'...
    'perRMT = str2double(get(UIEditRMT,''string''));'...
    'CSIntens_tmp=round(CSRMT*perRMT/100); set(UICSper,''string'',num2str(CSIntens_tmp))']);
UICSper  = uicontrol(gcf,'Style','Text','Position',[140,218 50 25],...
    'String','48','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEditCSact = uicontrol(gcf,'Style','Edit','Position',[210,218 50 25],...
    'String','48','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack','CSIntens = str2double(get(gcbo,''string''));');

%%% TS %%%
uicontrol(gcf,'Style','Text','Position',[20,196 30 25],...
    'String','TS:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEditTS = uicontrol(gcf,'Style','Edit','Position',[70,196 50 25],...
    'String','40','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack',['TSRMT = str2double(get(gcbo,''string''));'...
    'perRMT = str2double(get(UIEditRMT,''string''));'...
    'TSIntens_tmp=round(TSRMT*perRMT/100); set(UITSper,''string'',num2str(TSIntens_tmp))']);
UITSper  = uicontrol(gcf,'Style','Text','Position',[140,196 50 25],...
    'String','48','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIEditTSact = uicontrol(gcf,'Style','Edit','Position',[210,196 50 25],...
    'String','48','FontSize',16,'BackGroundColor',[1 1 1],...
    'CallBack','TSIntens = str2double(get(gcbo,''string''));');

uicontrol(gcf,'Style','Text','Position',[20,158 250 25],...
    'String','Sense [mV]:','FontSize',18,'BackGroundColor',[0.8 0.8 0.8]);
UIEditsens  = uicontrol(gcf,'Style','Edit','Position',[20,136 250 25],...
    'String','1','FontSize',18,'BackGroundColor',[1 1 1],...
    'CallBack','sense = str2double(get(gcbo,''string''));');                                


%% Center panel

uicontrol(gcf,'Style','Text','Position',[300 382 140 25],...
    'String','Visual Feedback:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIFB       = uicontrol(gcf,'Style','listbox','Position',[300 280 140 100],...
           'string','Yes|No','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[300 242 140 25],...
    'String','Feedback Value:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);   
UIPwrERD   = uicontrol(gcf,'Style','listbox','Position',[300 140 140 100],...
    'string','ERD|Power','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[460 382 140 25],...
    'String','Condition:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);       
UICONDI    = uicontrol(gcf,'Style','listbox','Position',[460 280 140 100],...
    'string','‡@Rest|‡Ai-ERD (high)|‡Bi-ERD (med)|‡Ci-ERD (low)|‡Dno-FB',...
    'FontSize',14,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[460 242 140 25],...
    'String','EEG Figure:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);   
UIDRAW     = uicontrol(gcf,'Style','listbox','Position',[460 140 140 100],...
    'string','Time&Topo|None', ...
    'FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

uicontrol(gcf,'Style','Text','Position',[620 382 140 25],...
    'String','MVC meas. side:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UIMVCside  = uicontrol(gcf,'Style','listbox','Position',[620 280 140 100],...
    'string','R FDI|L FDI|R ADM|L ADM','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
%     'CallBack','MVCside = get(gcbo,''value'');'); 

uicontrol(gcf,'Style','Text','Position',[620 242 140 25],...
    'String','Axis Transform:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);   
UIAXIS    = uicontrol(gcf,'Style','listbox','Position',[620 140 140 100],...
           'string','Yes|No','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
       
uicontrol(gcf,'Style','Text','Position',[780 382 140 25],...
    'String','Stim:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);
UISTIM  = uicontrol(gcf,'Style','listbox','Position',[780 280 140 100],...
    'string','Triggered|Non-triggerd','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);

% uicontrol(gcf,'Style','Text','Position',[780 242 140 25],...
%     'String','X:','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);   
% UIX    = uicontrol(gcf,'Style','listbox','Position',[780 140 140 100],...
%            'string','Yes|No','FontSize',16,'BackGroundColor',[0.8 0.8 0.8]);    
  
       
%% Bottom panel

UICalib    = uicontrol(gcf,'Style','Push','Position',[0 10 230 60],...
    'string','Calibration','FontSize',20,...
    'CallBack','recordingtag = 0; calibtag = 1; BCI_Calib'); 
UIStart    = uicontrol(gcf,'Style','Push','Position',[235 10 230 60],...
    'String','Start','FontSize',20,...
    'CallBack','recordingtag = 0; calibtag = 0; BCI_TMS');
UIStop     = uicontrol(gcf,'Style','Push','Position',[470 10 230 60],...
    'string','Stop','FontSize',20,'CallBack', ...
    'recordingtag = 1; STOP');      
UIClose    = uicontrol(gcf,'Style','Push','Position',[705 10 230 60],...
    'string','Close all','FontSize',20,'CallBack','CLOSE');
       
UIMVCmeas  = uicontrol(gcf,'Style','Push','Position',[0 70 230 40],...
    'String','MVC meas.','FontSize',18,'CallBack','MVC_meas;');
UIMEPmeas  = uicontrol(gcf,'Style','Push','Position',[235 70 230 40],...
    'String','MEP meas.','FontSize',18,'CallBack','MEP_meas;');
UIstopMEP  = uicontrol(gcf,'Style','Push','Position',[470 70 230 40],...
    'string','Stop MEP meas.','FontSize',18,'CallBack','stop_MEP;');
UIanaMEP   = uicontrol(gcf,'Style','Push','Position',[705 70 230 40],...
    'string','MEP analysis','FontSize',18,'CallBack','MEP_analysis;');
